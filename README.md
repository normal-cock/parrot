<!-- TOC -->

- [parrot](#parrot)
    - [介绍](#介绍)
    - [使用](#使用)
            - [安装](#安装)
            - [初始化环境](#初始化环境)
            - [添加单次](#添加单次)
            - [复习单词](#复习单词)
    - [规则](#规则)
        - [添加规则](#添加规则)
        - [复习规则](#复习规则)
            - [复习时展示哪些内容](#复习时展示哪些内容)
            - [完整的复习计划是什么](#完整的复习计划是什么)
            - [复习的结果有哪些](#复习的结果有哪些)
            - [如果有一天没有复习，第二天再复习时怎么办](#如果有一天没有复习第二天再复习时怎么办)
            - [在进行第五阶段复习时，仍然需要看句子才能知道含义怎么办？](#在进行第五阶段复习时仍然需要看句子才能知道含义怎么办)
    - [具体实现](#具体实现)
    - [issue log](#issue-log)
        - [Error: stepping, database disk image is malformed (11)](#error-stepping-database-disk-image-is-malformed-11)
    - [changelog](#changelog)
        - [Future](#future)
            - [背单词效率 P0——Done](#背单词效率-p0done)
            - [优化PC播放视频的体验 P0——Done](#优化pc播放视频的体验-p0done)
            - [优化 P1](#优化-p1)
        - [v2.2.0](#v220)
            - [手机和电脑端的信息的同步 P0——Done](#手机和电脑端的信息的同步-p0done)
            - [减少单词录入时间 P0——Done](#减少单词录入时间-p0done)
            - [移动端支持 P0——Done](#移动端支持-p0done)
            - [断点续背功能 P1——Done](#断点续背功能-p1done)
            - [随时听——Done](#随时听done)
            - [增加log P2——Done](#增加log-p2done)
        - [old](#old)

<!-- /TOC -->
# parrot
<!-- /MarkdownTOC -->
## 介绍
该项目是一个背单词的工具。虽然有很多商业的背单词软件，但这些软件功能上大同小异，最重要的是这些软件并不能满足我的需求。下面是我整理的需求以及市面上已有软件的满足情况：

| 我的需求                                                                                                     | 现有工具                                                                                                                           |
| :----------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------- |
| 创建自己的词库                                                                                               | 这一点很多软件支持                                                                                                                 |
| 电脑上使用。由于我是通过电脑来阅读英文材料，并收集未知的单词，因此电脑使用场景比较重。                       | 大部分软件都是以手机为主，电脑上几乎没什么功能。                                                                                   |
| 为单词添加语境。我觉得背单词得结合语境，所以将语境和单词一并记下来有助于单词的记忆，也可培养单词的语感       | 市面上大部分软件都不支持。虽然很多软件会给出自己的实例句子，但这些句子跟我读到这个单词的语境完全没有关系，我还是想添加自己的语境。 |
| 为单词添加新的含义。有些单词有特殊的用法，大部分已有的词典可能都没有涵盖到，因此需要自己去为单词创建新的含义 | 大部分现有软件不支持该需求，或者需要长时间的审批                                                                                   |
| 为单词添加备注。有些单词有特殊的用法，或者使用上有些要注意的地方，需要备注下来                               | 大部分现有软件不支持该需求                                                                                                         |

基于以上考虑，身为码农的我便决定为自己量身定做一个背单词工具，当然欢迎跟我有类似困扰的同学使用，并多提宝贵意见。
## 使用
#### 安装
`pip install git+https://github.com/chicken-house/parrot.git`
#### 初始化环境
`parrot migrate`
#### 添加单次
`parrot add`
#### 复习单词
`parrot review`

## 规则
### 添加规则
每日最多添加20个单词或短语
重新添加已经在词库的单词，会更新 changed_time ，并添加新的 review_plan，并把最后一个老的review_plan 的状态更新为“没记住”。

### 复习规则
#### 复习时展示哪些内容
展示单词、音标和句子，意思隐藏。
#### 完整的复习计划是什么
参考艾宾浩斯记忆曲线，time_to_review 为时间依据来复习。复习分为5个阶段，分别是1天后，2天后，6天后，15天后，30天后。举个例子：假如1.1添加的单词，复习时间分别为1.2、1.3、1.7、1.16、1.31。
#### 复习的结果有哪些
复习时，每个单词有三种结果：知道了，记住了，没记住。
 * 知道了。看到语义，想起了该单词的含义。这种选项下，会继续按照下面的复习计划来复习。
 * 记住了。只看单词就知道发音和含义，则是该选项。这种选项下，直接跳到第三复习阶段，即6天后复习。
 * 没记住。看了句子后仍不清楚单词的含义。这种选项下，重新跳回第一复习阶段，即1天后复习。
#### 如果有一天没有复习，第二天再复习时怎么办
把应该昨天复习的内容，拿到今天复习。比如昨天应该进行 hello 这个单词的第三阶段复习，但是临时有事没有复习。今天继续复习 hello 单词的第三阶段，复习完之后以当前时间为基准，7天后进行第四阶段复习。注意，这里不再根据 changed_time 来确定下一次复习时间，而是用当前的复习时间确定下一次复习时间。
#### 在进行第五阶段复习时，仍然需要看句子才能知道含义怎么办？
应该继续选择“知道了”，该单词的复习计划也会结束。这么做的考虑如下：
 * 这种情况应该比较少。所以对于这少数没有达到“记住了”的状态的单词，完全可以在下一次遇见时，重新添加，重新执行复习计划。
 * 背单词的目的是为了使用。既然能读明白，那么已经达到了基本的使用目的。

## 具体实现
创建一张复习计划表。代表每个单词的一次复习计划。只有7天内的复习计划才有效。
每次新加入一个单词，或者完成某一阶段（除了第五个复习阶段）的复习时，在该表中为该单词添加一条新的记录，代表下一次复习计划。
每次复习时，从复习计划表中选出未记录来复习，并根据复习结果和当前复习计划所处的阶段，决定是否为下一次复习创建新的复习计划。同时，将已经复习过的复习计划记录标记为已复习。

## issue log

### Error: stepping, database disk image is malformed (11)

sqlite3查询某个词的时候报这个错误，且重新dump并insert为新的库依然有这个问题。最终通过`rebuild_fts`解决了，估计是索引有什么问题。

## changelog

### Future

未来优化思路:
* [P0]提高碎片化时间的利用率
    * [P0]支持声音背单词，背单词就不需要电脑了。录入单词时，可以将句子的文件名和时间段存下来，第一版先只读句子就可以
        * [不可行]思路1: http的range不可以，因为range只能控制bytes的范围，无法转化为视频或音频时间
        * 思路2: 使用hls。
            * 思路2.1: aliyun的点播——不支持生成子m3u8文件
            * 思路2.2: 使用oss的流媒体能力——必须包含视频
                * https://help.aliyun.com/zh/oss/use-cases/create-hls-streams-based-on-oss?spm=a2c4g.11186623.0.i25
                * 上传时，貌似必须包含视频: https://help.aliyun.com/zh/oss/user-guide/rtmp-based-stream-ingest?spm=a2c4g.11186623.0.0.b2aa152ai6s40D#concept-vbb-dmb-5db 中的使用限制
                * 看看工单的回复——没有有用信息
            * 思路2.3: 基于oss自行实现
                * 测试一下，videojs能否播放m3u8——Done,需要将type变成`type='application/x-mpegURL'`
                * 自行处理m3u8文件的生成，下发给客户端——Done
                    * 全文件播放
                    * 部分播放
                * 自动上传的工具
                    * input: 字幕、视频
                    * output: oss目录，名称为item_name, 包含:
                        * 音频的m3u8和切片
                        * 视频
                        * 字幕
                * oss目录结构设计
                * 前端自动生成use_case_voice_code——Done
                * 处理快捷键。播放和空格是播放和暂停——Done
                    * 为字幕增加id，以便获取选中的字幕属于哪个cue，从而获取start和end时间
                    * 根据item_id、start_sec、end_sec生成voice_code，注意要考虑上adjustment
                * 测试——Done
* [P0]html页面支持一键将老单词录入ER中 P0——Done
* [P0]add er支持自动增加全文检索——Done
* [P0]review_er每个单词背完后，增加单词的其他意思的列表总结——Done
* [P1]提高背单词效率
    * [P0]7000单词内，先不要精背。提高速度
    * [P0]为ER增加随机和断点续背功能——Done
* [P1]提高单词录入效率

#### 背单词效率 P0——Done

思路：当前背单词时间太多(快2h了），且效率不高，影响泛读。最好能将每天背单词时间控制在1h内，然后通过泛读（重复遇见）来背。
    因为泛读的方式更贴近生活，更贴近“用起来”

先通过ER背
ER背过的2遍，又遇到且忘记的，再精背
    筛选出常用单词来精背

#### 优化PC播放视频的体验 P0——Done

参考feishu minutes的体验

#### 优化 P1

[P1]“[减少录入时间](doc/keyfeatures/减少录入时间.md)”剩余功能
[P2]增加删除word或meaning的能力
[P2]手机背单词
[P2]根据单词和例句的中文翻译，复习英文 P2
[P2]“[随时听](doc/keyfeatures/随时听.md)”剩余功能
[P3] [其他思路](doc/keyfeatures/99.其他思路.md)




### v2.2.0

#### 手机和电脑端的信息的同步 P0——Done

例如播放进度、字幕调整时间等

直接用filedisk，简单方便
通过`version`来确保更新前已经同步过最新进度了
heartbeat上报时机: 播放状态，每10秒钟一次。

#### 减少单词录入时间 P0——Done

#### 移动端支持 P0——Done

充分利用碎片时间。

* [P0]手机查单词
    * [P0]一键在词库中查询选中单词-模糊——Done
    * [P0]一键在词库中查询选中单词-精准——Done

#### 断点续背功能 P1——Done

随时结束，随时开始，充分利用碎片化时间
背到一半不小心退出，结果要重背。
续背功能跟reviewplan的生成解耦开，不影响第二天复习。

#### 随时听——Done

* [P0]逐句循环播放——Done
* [P0]快进到上一句或下一句——Done
* [P0]本次播放进度缓存——Done
* [P0]支持视频语音的切换——Done
* [P2]偶尔自动回到开头的bug修复，尤其是切换视频的时候。看看是否需要加加载状态时锁定的逻辑——Done

* [P1]字幕时间可以前端调整——Done
    * [P1]可以分别调整start time和end time——Done
* [P1]建模——Done
    * [P2]字幕修正时间的存储——Done
    * [P1]播放列表——Done
* [P1]双语字幕支持——Done

#### 增加log P2——Done

### [old](doc/changelog.md)
